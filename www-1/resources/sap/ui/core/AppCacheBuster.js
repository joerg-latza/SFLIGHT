/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.ui.core.Core");jQuery.sap.require("sap.ui.thirdparty.URI");jQuery.sap.declare("sap.ui.core.AppCacheBuster",false);(function(){var c=window.URI;var C=sap.ui.getCore().getConfiguration();var l=C.getLanguage();var i={};var a=jQuery.ajax;var I=jQuery.sap.includeScript;var f=jQuery.sap.includeStyleSheet;var v=sap.ui.base.ManagedObject.prototype.validateProperty;var L=document.location.href.replace(/\?.*|#.*/g,"");var b=c("./").absoluteTo(L);var A=b.toString();var u=c(jQuery.sap.getModulePath("","/../"));var o=u.toString();if(u.is("relative")){u=u.absoluteTo(L)}var B=u.normalize().toString();var r=c("resources").absoluteTo(B).toString();var F=new RegExp("^"+r);sap.ui.core.AppCacheBuster={init:function(){var d=sap.ui.core.AppCacheBuster.convertURL;var n=sap.ui.core.AppCacheBuster.normalizeURL;var e=function(U){if(U&&typeof(U)==="string"){U=n(U);return!U.match(F)}return false};jQuery.ajax=function(g,h){if(g&&g.url&&e(g.url)){g.url=d(g.url)}return a.apply(this,arguments)};jQuery.sap.includeScript=function(U,s){if(e(U)){U=d(U)}return I.apply(this,arguments)};jQuery.sap.includeStyleSheet=function(U,s){if(e(U)){U=d(U)}return f.apply(this,arguments)};sap.ui.base.ManagedObject.prototype.validateProperty=function(p,V){if(e(V)){var m=this.getMetadata(),P=m.getAllProperties()[p];if(P){if(P.type==="sap.ui.core.URI"){V=d(V)}}}return v.apply(this,arguments)}},exit:function(){jQuery.ajax=a;jQuery.sap.includeScript=I;jQuery.sap.includeStyleSheet=f;sap.ui.base.ManagedObject.prototype.validateProperty=v;i={}},register:function(B){jQuery.sap.log.debug("sap.ui.core.AppCacheBuster.register(\""+B+"\");");var s=sap.ui.core.AppCacheBuster.normalizeURL(B);jQuery.sap.log.debug("  --> normalized to: \""+s+"\"");if(!i[s]){var U=s+"sap-ui-cachebuster-info.json?sap-ui-language="+l;jQuery.sap.log.info("Loading AppCacheBuster index file from: \""+U+"\".");var R=jQuery.sap.sjax({url:U,dataType:"json"});if(R&&R.data){i[s]=R.data}else{jQuery.sap.log.error("Failed to load AppCacheBuster index file from: \""+U+"\".")}}},convertURL:function(U){jQuery.sap.log.debug("sap.ui.core.AppCacheBuster.convertURL(\""+U+"\");");if(i&&U){U=sap.ui.core.AppCacheBuster.normalizeURL(U);jQuery.sap.log.debug("  --> normalized to: \""+U+"\"");if(U&&sap.ui.core.AppCacheBuster.handleURL(U)){jQuery.each(i,function(B,m){var s;if(B&&U.length>=B.length&&U.slice(0,B.length)===B){s=U.slice(B.length);if(m[s]){U=B+"~"+m[s]+"~/"+s;jQuery.sap.log.debug("  ==> return \""+U+"\";");return false}}})}}return U},normalizeURL:function(U){var u=c(U||"./");if(u.is("relative")){u=u.absoluteTo(L)}return u.normalize().toString()},handleURL:function(U){return true}};if(C.getAppCacheBuster()){sap.ui.core.AppCacheBuster.init();var u=c(o);if(u.is("relative")){sap.ui.core.AppCacheBuster.register(u.toString())}}}());
