/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ui.commons.layout.ResponsiveFlowLayout");jQuery.sap.require("sap.ui.commons.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.ui.commons.layout.ResponsiveFlowLayout",{metadata:{library:"sap.ui.commons",properties:{"responsive":{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{"content":{type:"sap.ui.core.Control",multiple:true,singularName:"content"}}}});(function(){sap.ui.commons.layout.ResponsiveFlowLayout.prototype.init=function(){this._rows=[];this._delayedCallId=-1};sap.ui.commons.layout.ResponsiveFlowLayout.prototype.exit=function(){delete this._rows;delete this._delayedCallId};var u=function(t){var C=t.getContent();var r=[];var R=-1;for(var i=0;i<C.length;i++){var m=sap.ui.commons.layout.ResponsiveFlowLayoutData.MIN_WIDTH;var w=sap.ui.commons.layout.ResponsiveFlowLayoutData.WEIGHT;var B=sap.ui.commons.layout.ResponsiveFlowLayoutData.LINEBREAK;var l=C[i].getLayoutData();if(l instanceof sap.ui.commons.layout.ResponsiveFlowLayoutData){B=l.getLinebreak();m=l.getMinWidth();w=l.getWeight()}if(R<0||B){R++;r.push({height:-1,cont:[]})}var j=r[R].cont.length;var I=C[i].getId()+"-cont"+R+"_"+j;var o={minwidth:m,weight:w,padding:"5px",control:C[i],id:I};r[R].cont.push(o)}t._rows=r};var g=function(R,$,t){var r=[];var l=10000000;var d=-1;var i=t.getId();for(var j=0;j<R.cont.length;j++){var e=jQuery.sap.byId(i+"-"+R.cont[j].id);if(e.length>0){var o=e[0].offsetLeft;if(l>=o){r.push({cont:[]});d++}l=o;r[d].cont.push(R.cont[j])}}return r};var a=function(R,$){var w=$.width();var r=[];var d=-1;var i=0;for(var j=0;j<R.cont.length;j++){var e=0;var t=0;for(var k=i;k<=j;k++){t=t+R.cont[k].weight}for(var k=i;k<=j;k++){var f=w/t*R.cont[k].weight;f=Math.floor(f);var l=R.cont[k].minwidth;e+=Math.max(f,l)}if(d==-1||e>w){r.push({cont:[]});if(d!==-1){i=j}d++}r[d].cont.push(R.cont[j])}return r};var c=function(w,d){if(w.length!=d.length){return true}for(var i=0;i<w.length;i++){if(w[i].cont.length!=d[i].cont.length){return true}}return false};var b=function(t,I){var d=t._rows;var s=t.getId();for(var i=0;i<d.length;i++){var $=jQuery.sap.byId(s+"-row"+i);var T=a(d[i],$);var C=g(d[i],$,t);if(I||d[i].height!=$.height()||c(C,T)){var r=T;for(var j=0;j<r.length;j++){var R=0;var w=[];for(var k=0;k<r[j].cont.length;k++){var e=0;for(var z=0;z<r[j].cont.length;z++){e+=r[j].cont[z].weight}var o=r[j].cont[k];var f=jQuery.sap.byId(o.id);var p=100/e*o.weight;p=Math.floor(p);w.push(p);R+=p;f.css("width",p+"%")}if(R<100){var D=100-R;var S=D/r[j].cont.length;S=Math.ceil(S);for(var k=0;k<r[j].cont.length;k++){var o=r[j].cont[k];var f=jQuery.sap.byId(o.id);var W=w[k];W+=S;f.css("width",W+"%");D-=S;if(D<=0){break}}}}d[i].height=$.height()}}};var h=function(){jQuery.sap.clearDelayedCall(this._delayedCallId);delete this._delayedCallId;b(this);this._delayedCallId=jQuery.sap.delayedCall(300,this,h)};sap.ui.commons.layout.ResponsiveFlowLayout.prototype.onBeforeRendering=function(){u(this)};sap.ui.commons.layout.ResponsiveFlowLayout.prototype.onAfterRendering=function(e){if(this.getResponsive()){b(this,true);this._delayedCallId=jQuery.sap.delayedCall(300,this,h)}};sap.ui.commons.layout.ResponsiveFlowLayout.prototype.onThemeChanged=function(e){jQuery.sap.clearDelayedCall(this._delayedCallId);this.invalidate()};sap.ui.commons.layout.ResponsiveFlowLayout.prototype.onLayoutDataChange=sap.ui.commons.layout.ResponsiveFlowLayout.prototype.onThemeChanged}());
